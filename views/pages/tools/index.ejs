<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Tools | DVLCube</title>
    <!-- Materialize CSS -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <style>
        :root {
            --primary-color: #1976d2;
            --primary-dark: #1565c0;
            --accent-color: #ff4081;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
            --text-primary: #212121;
            --text-secondary: #757575;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: var(--background-color);
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        }

        .brand-logo {
            font-weight: 500;
            display: flex;
            align-items: center;
        }

        .brand-logo i {
            margin-right: 10px;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 64px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--card-background);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            height: calc(100vh - 64px);
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar .collection {
            border: none;
            margin: 0;
        }

        .sidebar .collection-item {
            border: none !important;
            padding: 16px 24px;
            cursor: pointer;
            transition: background-color 0.3s, border-left 0.3s;
            border-left: 4px solid transparent !important;
        }

        .sidebar .collection-item:hover {
            background-color: #e3f2fd;
        }

        .sidebar .collection-item.active {
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary-color) !important;
        }

        .sidebar .collection-item .category-icon {
            margin-right: 16px;
            color: var(--primary-color);
        }

        .sidebar .collection-item .category-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .sidebar .collection-item .category-desc {
            font-size: 12px;
            color: var(--text-secondary);
            display: block;
            margin-top: 4px;
        }

        /* Content Area */
        .content-area {
            margin-left: 280px;
            flex: 1;
            padding: 24px;
            display: flex;
        }

        .tools-panel {
            flex: 1;
            max-width: 800px;
        }

        /* Ad Space */
        .ad-sidebar {
            width: 300px;
            margin-left: 24px;
            position: sticky;
            top: 24px;
            height: fit-content;
        }

        .ad-container {
            background: var(--card-background);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .ad-placeholder {
            background: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 4px;
            padding: 40px 20px;
            color: #999;
            font-size: 14px;
        }

        .ad-placeholder.large {
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-placeholder.banner {
            min-height: 90px;
        }

        /* Route Cards */
        .route-card {
            background: var(--card-background);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s;
        }

        .route-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .route-card h5 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .route-card .route-description {
            color: var(--text-secondary);
            margin-bottom: 16px;
            font-size: 14px;
        }

        .route-card .route-path {
            font-family: 'Roboto Mono', monospace;
            background: #f5f5f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: var(--primary-color);
            margin-bottom: 16px;
            display: inline-block;
        }

        .route-card .input-field {
            margin-bottom: 16px;
        }

        .route-card .input-field label {
            color: var(--text-secondary);
        }

        .route-card .input-field input:focus,
        .route-card .input-field textarea:focus {
            border-bottom-color: var(--primary-color) !important;
            box-shadow: 0 1px 0 0 var(--primary-color) !important;
        }

        .route-card .input-field input:focus + label,
        .route-card .input-field textarea:focus + label {
            color: var(--primary-color) !important;
        }

        .route-card .btn {
            background-color: var(--primary-color);
        }

        .route-card .btn:hover {
            background-color: var(--primary-dark);
        }

        /* Result Display */
        .result-container {
            margin-top: 16px;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-box {
            background: #263238;
            color: #a5d6a7;
            border-radius: 4px;
            padding: 16px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .result-box.error {
            color: #ef9a9a;
        }

        .result-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        .result-actions .btn-small {
            background-color: #455a64;
        }

        .result-actions .btn-small:hover {
            background-color: #546e7a;
        }

        /* Welcome Panel */
        .welcome-panel {
            text-align: center;
            padding: 60px 24px;
        }

        .welcome-panel i.large-icon {
            font-size: 80px;
            color: var(--primary-color);
            margin-bottom: 24px;
        }

        .welcome-panel h4 {
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .welcome-panel p {
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
        }

        .loading-spinner.show {
            display: inline-block;
        }

        /* Category Header */
        .category-header {
            margin-bottom: 24px;
        }

        .category-header h4 {
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
        }

        .category-header h4 i {
            margin-right: 12px;
            color: var(--primary-color);
        }

        .category-header p {
            color: var(--text-secondary);
            margin: 0;
        }

        /* History Panel */
        .history-panel {
            background: var(--card-background);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .history-panel h6 {
            margin: 0 0 12px 0;
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .history-panel h6 i {
            margin-right: 8px;
            font-size: 18px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .history-item:hover {
            background: #e3f2fd;
        }

        .history-item .history-path {
            font-family: 'Roboto Mono', monospace;
            font-size: 11px;
            color: var(--primary-color);
        }

        .history-item .history-result {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .ad-sidebar {
                display: none;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .content-area {
                margin-left: 0;
                flex-direction: column;
            }

            .main-container {
                flex-direction: column;
            }
        }

        /* Tooltip */
        .copy-tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .copy-tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-wrapper">
            <a href="/" class="brand-logo" style="margin-left: 20px;">
                <i class="material-icons">build</i>
                DVLCube Tools
            </a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="/">Home</a></li>
                <li><a href="https://github.com/dvlcube" target="_blank"><i class="material-icons left">code</i>GitHub</a></li>
            </ul>
        </div>
    </nav>

    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="collection">
                <% for (const [key, category] of Object.entries(routeMetadata)) { %>
                <li class="collection-item" data-category="<%= key %>" onclick="selectCategory('<%= key %>')">
                    <div class="valign-wrapper">
                        <i class="material-icons category-icon"><%= category.icon %></i>
                        <div>
                            <span class="category-name"><%= category.name %></span>
                            <span class="category-desc"><%= category.description %></span>
                        </div>
                    </div>
                </li>
                <% } %>
            </ul>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <div class="tools-panel">
                <!-- Welcome Panel (shown when no category selected) -->
                <div id="welcome-panel" class="welcome-panel">
                    <i class="material-icons large-icon">handyman</i>
                    <h4>Welcome to Developer Tools</h4>
                    <p>Select a category from the sidebar to get started. Each tool allows you to generate, validate, or encode data quickly and easily.</p>
                </div>

                <!-- Dynamic Content Area -->
                <div id="tools-content" style="display: none;">
                    <div class="category-header">
                        <h4 id="category-title"><i class="material-icons" id="category-icon"></i><span id="category-name"></span></h4>
                        <p id="category-description"></p>
                    </div>
                    <div id="routes-container"></div>
                </div>
            </div>

            <!-- Ad Sidebar -->
            <div class="ad-sidebar">
                <div class="ad-container">
                    <div class="ad-placeholder large">
                        <span>Ad Space<br>300 x 250</span>
                    </div>
                </div>
                <div class="ad-container">
                    <div class="ad-placeholder banner">
                        <span>Ad Space - 300 x 90</span>
                    </div>
                </div>
                
                <!-- History Panel -->
                <div class="history-panel" id="history-panel" style="display: none;">
                    <h6><i class="material-icons">history</i>Recent Results</h6>
                    <div class="history-list" id="history-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
    <script>
        // Route metadata from server (embedded as JSON string and parsed at runtime)
        const routeMetadata = JSON.parse('<%- JSON.stringify(routeMetadata) %>');
        
        // History storage
        let resultHistory = [];
        const MAX_HISTORY = 10;

        // Select a category
        function selectCategory(categoryKey) {
            const category = routeMetadata[categoryKey];
            if (!category) return;

            // Update sidebar active state
            document.querySelectorAll('.sidebar .collection-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-category="${categoryKey}"]`).classList.add('active');

            // Show tools content
            document.getElementById('welcome-panel').style.display = 'none';
            document.getElementById('tools-content').style.display = 'block';

            // Update header
            document.getElementById('category-icon').textContent = category.icon;
            document.getElementById('category-name').textContent = category.name;
            document.getElementById('category-description').textContent = category.description;

            // Render routes
            renderRoutes(category.routes);
        }

        // Render route cards
        function renderRoutes(routes) {
            const container = document.getElementById('routes-container');
            container.innerHTML = '';

            routes.forEach((route, index) => {
                const card = document.createElement('div');
                card.className = 'route-card';
                card.id = `route-${index}`;

                let paramsHtml = '';
                route.params.forEach(param => {
                    if (param.type === 'select') {
                        paramsHtml += `
                            <div class="input-field">
                                <select id="param-${index}-${param.name}" data-param="${param.name}">
                                    ${param.options.map(opt => `<option value="${opt}" ${opt === param.default ? 'selected' : ''}>${opt}</option>`).join('')}
                                </select>
                                <label>${param.name}${param.required ? ' *' : ''}</label>
                            </div>
                        `;
                    } else if (param.type === 'textarea') {
                        paramsHtml += `
                            <div class="input-field">
                                <textarea id="param-${index}-${param.name}" class="materialize-textarea" data-param="${param.name}" placeholder="${param.placeholder || ''}" ${param.required ? 'required' : ''}></textarea>
                                <label for="param-${index}-${param.name}">${param.name}${param.required ? ' *' : ''}</label>
                            </div>
                        `;
                    } else {
                        paramsHtml += `
                            <div class="input-field">
                                <input type="text" id="param-${index}-${param.name}" data-param="${param.name}" placeholder="${param.placeholder || ''}" ${param.required ? 'required' : ''}>
                                <label for="param-${index}-${param.name}">${param.name}${param.required ? ' *' : ''}</label>
                            </div>
                        `;
                    }
                });

                card.innerHTML = `
                    <h5>${route.name}</h5>
                    <p class="route-description">${route.description}</p>
                    <div class="route-path">${route.method} ${route.path}</div>
                    <form onsubmit="callRoute(event, ${index}, '${route.path}')">
                        ${paramsHtml}
                        <button type="submit" class="btn waves-effect waves-light">
                            <i class="material-icons left">send</i>
                            Execute
                            <div class="preloader-wrapper small loading-spinner" id="spinner-${index}">
                                <div class="spinner-layer spinner-white-only">
                                    <div class="circle-clipper left"><div class="circle"></div></div>
                                </div>
                            </div>
                        </button>
                    </form>
                    <div class="result-container" id="result-${index}">
                        <div class="result-box" id="result-box-${index}"></div>
                        <div class="result-actions">
                            <button class="btn-small waves-effect" onclick="copyResult(${index})">
                                <i class="material-icons left">content_copy</i>Copy
                            </button>
                            <button class="btn-small waves-effect" onclick="useAsInput(${index})">
                                <i class="material-icons left">input</i>Use as Input
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });

            // Initialize Materialize selects
            M.FormSelect.init(document.querySelectorAll('select'));
        }

        // Call a route
        async function callRoute(event, index, path) {
            event.preventDefault();

            const form = event.target;
            const inputs = form.querySelectorAll('[data-param]');
            const params = new URLSearchParams();

            inputs.forEach(input => {
                const value = input.value.trim();
                if (value) {
                    params.append(input.dataset.param, value);
                }
            });

            const url = params.toString() ? `${path}?${params.toString()}` : path;

            // Show spinner
            const spinner = document.getElementById(`spinner-${index}`);
            spinner.classList.add('active', 'show');

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                const resultContainer = document.getElementById(`result-${index}`);
                const resultBox = document.getElementById(`result-box-${index}`);
                
                resultBox.textContent = JSON.stringify(data, null, 2);
                resultBox.classList.remove('error');
                
                if (!response.ok) {
                    resultBox.classList.add('error');
                }
                
                resultContainer.classList.add('show');

                // Add to history
                addToHistory(url, data);

            } catch (error) {
                const resultContainer = document.getElementById(`result-${index}`);
                const resultBox = document.getElementById(`result-box-${index}`);
                
                resultBox.textContent = `Error: ${error.message}`;
                resultBox.classList.add('error');
                resultContainer.classList.add('show');
            } finally {
                spinner.classList.remove('active', 'show');
            }
        }

        // Copy result to clipboard
        function copyResult(index) {
            const resultBox = document.getElementById(`result-box-${index}`);
            const text = resultBox.textContent;

            navigator.clipboard.writeText(text).then(() => {
                M.toast({html: 'Copied to clipboard!', classes: 'rounded'});
            }).catch(err => {
                M.toast({html: 'Failed to copy', classes: 'rounded red'});
            });
        }

        // Use result as input in another field
        let lastResult = null;
        function useAsInput(index) {
            const resultBox = document.getElementById(`result-box-${index}`);
            try {
                lastResult = JSON.parse(resultBox.textContent);
                
                // Extract the main value from common result keys
                let value = '';
                if (lastResult.encoded) value = lastResult.encoded;
                else if (lastResult.decoded) value = lastResult.decoded;
                else if (lastResult.cpf) value = lastResult.cpf;
                else if (lastResult.cnpj) value = lastResult.cnpj;
                else if (lastResult.title) value = lastResult.title;
                else if (lastResult.valid !== undefined) value = lastResult.valid.toString();
                else value = JSON.stringify(lastResult);

                // Copy to clipboard and show toast
                navigator.clipboard.writeText(value).then(() => {
                    M.toast({html: `Value "${value.substring(0, 30)}${value.length > 30 ? '...' : ''}" copied! Paste it in any input field.`, classes: 'rounded', displayLength: 4000});
                });

            } catch (e) {
                M.toast({html: 'Could not parse result', classes: 'rounded red'});
            }
        }

        // Add to history
        function addToHistory(path, data) {
            resultHistory.unshift({ path, data, timestamp: new Date() });
            if (resultHistory.length > MAX_HISTORY) {
                resultHistory.pop();
            }
            renderHistory();
        }

        // Render history
        function renderHistory() {
            const panel = document.getElementById('history-panel');
            const list = document.getElementById('history-list');

            if (resultHistory.length === 0) {
                panel.style.display = 'none';
                return;
            }

            panel.style.display = 'block';
            list.innerHTML = '';

            resultHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.onclick = () => {
                    navigator.clipboard.writeText(JSON.stringify(item.data, null, 2));
                    M.toast({html: 'Result copied!', classes: 'rounded'});
                };

                const resultPreview = JSON.stringify(item.data).substring(0, 50);
                div.innerHTML = `
                    <div class="history-path">${item.path}</div>
                    <div class="history-result">${resultPreview}${resultPreview.length >= 50 ? '...' : ''}</div>
                `;
                list.appendChild(div);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            M.AutoInit();
        });
    </script>
</body>
</html>
